# Sigmoid

## 0x00 说明

包含以下内容：

- [X] sigmoid_f32_kernel
- [X] sigmoid_f32x4_kernel(float4向量化版本)
- [X] sigmoid_f16_kernel
- [X] sigmoid_f16x2_kernel(half2向量化)
- [X] sigmoid_f16x8_kernel(unpack版本)
- [X] sigmoid_f16x8_pack_kernel(pack版本)
- [X] PyTorch bindings


## 测试

```bash
# 只测试Ada架构 不指定默认编译所有架构 耗时较长: Volta, Ampere, Ada, Hopper, ...
export TORCH_CUDA_ARCH_LIST=Ada 
python3 sigmoid.py
```

输出:

```bash
-------------------------------------------------------------------------------------
                                        S=1024, K=1024
           out_f32: [0.68919814, 0.37103432], time:0.00563478ms
         out_f32x4: [0.68919814, 0.37103432], time:0.00370646ms
        out_f32_th: [0.68919814, 0.37103432], time:0.00576425ms
-------------------------------------------------------------------------------------
           out_f16: [0.68896484, 0.37109375], time:0.00638676ms
         out_f16x2: [0.68896484, 0.37109375], time:0.00354910ms
         out_f16x8: [0.68896484, 0.37109375], time:0.00367451ms
     out_f16x8pack: [0.68896484, 0.37109375], time:0.00370884ms
        out_f16_th: [0.68896484, 0.37109375], time:0.00567985ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=1024, K=2048
           out_f32: [0.38874274, 0.44405776], time:0.00722098ms
         out_f32x4: [0.38874274, 0.44405776], time:0.00494838ms
        out_f32_th: [0.38874274, 0.44405776], time:0.00566697ms
-------------------------------------------------------------------------------------
           out_f16: [0.38867188, 0.4440918], time:0.00784016ms
         out_f16x2: [0.38867188, 0.4440918], time:0.00748515ms
         out_f16x8: [0.38867188, 0.4440918], time:0.00568652ms
     out_f16x8pack: [0.38867188, 0.4440918], time:0.00422883ms
        out_f16_th: [0.38867188, 0.4440918], time:0.00566697ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=1024, K=4096
           out_f32: [0.59951311, 0.40737447], time:0.01265526ms
         out_f32x4: [0.59951311, 0.40737447], time:0.00922751ms
        out_f32_th: [0.59951305, 0.40737447], time:0.00842571ms
-------------------------------------------------------------------------------------
           out_f16: [0.59960938, 0.40722656], time:0.01393223ms
         out_f16x2: [0.59960938, 0.40722656], time:0.01035023ms
         out_f16x8: [0.59960938, 0.40722656], time:0.00980020ms
     out_f16x8pack: [0.59960938, 0.40722656], time:0.00676632ms
        out_f16_th: [0.59960938, 0.4074707], time:0.00692296ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=1024
           out_f32: [0.75156671, 0.7535817], time:0.00957298ms
         out_f32x4: [0.75156671, 0.7535817], time:0.00495720ms
        out_f32_th: [0.75156665, 0.7535817], time:0.00566721ms
-------------------------------------------------------------------------------------
           out_f16: [0.75195312, 0.75341797], time:0.01125717ms
         out_f16x2: [0.75195312, 0.75341797], time:0.00592303ms
         out_f16x8: [0.75195312, 0.75341797], time:0.00506973ms
     out_f16x8pack: [0.75195312, 0.75341797], time:0.00419903ms
        out_f16_th: [0.75146484, 0.75341797], time:0.00567865ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=2048
           out_f32: [0.63868785, 0.87350833], time:0.01265430ms
         out_f32x4: [0.63868785, 0.87350833], time:0.00815344ms
        out_f32_th: [0.63868785, 0.87350833], time:0.00842357ms
-------------------------------------------------------------------------------------
           out_f16: [0.63867188, 0.87353516], time:0.01393294ms
         out_f16x2: [0.63867188, 0.87353516], time:0.01325536ms
         out_f16x8: [0.63867188, 0.87353516], time:0.00920200ms
     out_f16x8pack: [0.63867188, 0.87353516], time:0.00658989ms
        out_f16_th: [0.63867188, 0.87353516], time:0.00692558ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=4096
           out_f32: [0.68829387, 0.86458832], time:0.02354550ms
         out_f32x4: [0.68829387, 0.86458832], time:0.01642895ms
        out_f32_th: [0.68829387, 0.86458838], time:0.01490569ms
-------------------------------------------------------------------------------------
           out_f16: [0.68798828, 0.86474609], time:0.02601480ms
         out_f16x2: [0.68798828, 0.86474609], time:0.01906967ms
         out_f16x8: [0.68798828, 0.86474609], time:0.01742220ms
     out_f16x8pack: [0.68798828, 0.86474609], time:0.01142383ms
        out_f16_th: [0.68847656, 0.86474609], time:0.01189470ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=1024
           out_f32: [0.73401731, 0.48190504], time:0.01741576ms
         out_f32x4: [0.73401731, 0.48190504], time:0.00823951ms
        out_f32_th: [0.73401731, 0.48190504], time:0.00842834ms
-------------------------------------------------------------------------------------
           out_f16: [0.73388672, 0.48217773], time:0.02083182ms
         out_f16x2: [0.73388672, 0.48217773], time:0.00901842ms
         out_f16x8: [0.73388672, 0.48217773], time:0.00793672ms
     out_f16x8pack: [0.73388672, 0.48217773], time:0.00658131ms
        out_f16_th: [0.73388672, 0.48193359], time:0.00692177ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=2048
           out_f32: [0.62901723, 0.40741974], time:0.02355123ms
         out_f32x4: [0.62901723, 0.40741974], time:0.01470804ms
        out_f32_th: [0.62901723, 0.40741974], time:0.01491427ms
-------------------------------------------------------------------------------------
           out_f16: [0.62890625, 0.40722656], time:0.02601695ms
         out_f16x2: [0.62890625, 0.40722656], time:0.02475381ms
         out_f16x8: [0.62890625, 0.40722656], time:0.01649356ms
     out_f16x8pack: [0.62890625, 0.40722656], time:0.01125836ms
        out_f16_th: [0.62890625, 0.4074707], time:0.01189661ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=4096
           out_f32: [0.61078298, 0.24497166], time:0.18634176ms
         out_f32x4: [0.61078298, 0.24497166], time:0.18633699ms
        out_f32_th: [0.61078292, 0.24497166], time:0.18860745ms
-------------------------------------------------------------------------------------
           out_f16: [0.61083984, 0.24475098], time:0.05021238ms
         out_f16x2: [0.61083984, 0.24475098], time:0.03640413ms
         out_f16x8: [0.61083984, 0.24475098], time:0.03263068ms
     out_f16x8pack: [0.61083984, 0.24475098], time:0.02065420ms
        out_f16_th: [0.61083984, 0.24487305], time:0.02181959ms
-------------------------------------------------------------------------------------
```


A6000
```
-------------------------------------------------------------------------------------
                                        S=1024, K=1024
           out_f32: [0.57620752, 0.50639629], time:0.00423193ms
         out_f32x4: [0.57620752, 0.50639629], time:0.00336361ms
        out_f32_th: [0.57620752, 0.50639623], time:0.00348306ms
-------------------------------------------------------------------------------------
           out_f16: [0.57617188, 0.50634766], time:0.00481009ms
         out_f16x2: [0.57617188, 0.50634766], time:0.00298381ms
         out_f16x8: [0.57617188, 0.50634766], time:0.00636268ms
     out_f16x8pack: [0.57617188, 0.50634766], time:0.00296998ms
        out_f16_th: [0.57617188, 0.50634766], time:0.00383592ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=1024, K=2048
           out_f32: [0.38597083, 0.55293012], time:0.00613427ms
         out_f32x4: [0.38597083, 0.55293012], time:0.00499845ms
        out_f32_th: [0.38597083, 0.55293012], time:0.00510144ms
-------------------------------------------------------------------------------------
           out_f16: [0.38623047, 0.55273438], time:0.00628376ms
         out_f16x2: [0.38623047, 0.55273438], time:0.00540757ms
         out_f16x8: [0.38623047, 0.55273438], time:0.00537133ms
     out_f16x8pack: [0.38623047, 0.55273438], time:0.00345588ms
        out_f16_th: [0.38598633, 0.55273438], time:0.00410056ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=1024, K=4096
           out_f32: [0.61810732, 0.89508921], time:0.01033473ms
         out_f32x4: [0.61810732, 0.89508921], time:0.00802827ms
        out_f32_th: [0.61810732, 0.89508921], time:0.00822258ms
-------------------------------------------------------------------------------------
           out_f16: [0.61816406, 0.89501953], time:0.01045394ms
         out_f16x2: [0.61816406, 0.89501953], time:0.01014757ms
         out_f16x8: [0.61816406, 0.89501953], time:0.00914764ms
     out_f16x8pack: [0.61816406, 0.89501953], time:0.00515008ms
        out_f16_th: [0.61816406, 0.89501953], time:0.00617409ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=1024
           out_f32: [0.65510976, 0.74867088], time:0.00687194ms
         out_f32x4: [0.65510976, 0.74867088], time:0.00504136ms
        out_f32_th: [0.6551097, 0.74867088], time:0.00507450ms
-------------------------------------------------------------------------------------
           out_f16: [0.65527344, 0.74853516], time:0.00797629ms
         out_f16x2: [0.65527344, 0.74853516], time:0.00434327ms
         out_f16x8: [0.65527344, 0.74853516], time:0.00494671ms
     out_f16x8pack: [0.65527344, 0.74853516], time:0.00340009ms
        out_f16_th: [0.65527344, 0.74853516], time:0.00401378ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=2048
           out_f32: [0.75313997, 0.26859713], time:0.01034665ms
         out_f32x4: [0.75313997, 0.26859713], time:0.00812507ms
        out_f32_th: [0.75313997, 0.26859713], time:0.00820088ms
-------------------------------------------------------------------------------------
           out_f16: [0.75292969, 0.26855469], time:0.01044703ms
         out_f16x2: [0.75292969, 0.26855469], time:0.00909948ms
         out_f16x8: [0.75292969, 0.26855469], time:0.00876570ms
     out_f16x8pack: [0.75292969, 0.26855469], time:0.00503683ms
        out_f16_th: [0.75292969, 0.26855469], time:0.00618124ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=4096
           out_f32: [0.43056861, 0.37963337], time:0.01897740ms
         out_f32x4: [0.43056861, 0.37963337], time:0.01448059ms
        out_f32_th: [0.43056861, 0.37963337], time:0.01456428ms
-------------------------------------------------------------------------------------
           out_f16: [0.43066406, 0.37963867], time:0.01907182ms
         out_f16x2: [0.43066406, 0.37963867], time:0.01866961ms
         out_f16x8: [0.43066406, 0.37963867], time:0.01671791ms
     out_f16x8pack: [0.43066406, 0.37963867], time:0.00834894ms
        out_f16_th: [0.43066406, 0.37963867], time:0.01043296ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=1024
           out_f32: [0.52217233, 0.18181825], time:0.01208472ms
         out_f32x4: [0.52217233, 0.18181825], time:0.00816798ms
        out_f32_th: [0.52217233, 0.18181825], time:0.00821853ms
-------------------------------------------------------------------------------------
           out_f16: [0.52197266, 0.1817627], time:0.01414323ms
         out_f16x2: [0.52197266, 0.1817627], time:0.00702381ms
         out_f16x8: [0.52197266, 0.1817627], time:0.00835323ms
     out_f16x8pack: [0.52197266, 0.1817627], time:0.00491095ms
        out_f16_th: [0.52197266, 0.18188477], time:0.00619888ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=2048
           out_f32: [0.12308291, 0.46617618], time:0.01890469ms
         out_f32x4: [0.12308291, 0.46617618], time:0.01448059ms
        out_f32_th: [0.12308291, 0.46617618], time:0.01463127ms
-------------------------------------------------------------------------------------
           out_f16: [0.12304688, 0.46630859], time:0.01894975ms
         out_f16x2: [0.12304688, 0.46630859], time:0.01657748ms
         out_f16x8: [0.12304688, 0.46630859], time:0.01591110ms
     out_f16x8pack: [0.12304688, 0.46630859], time:0.00820780ms
        out_f16_th: [0.12304688, 0.46606445], time:0.01044130ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=4096
           out_f32: [0.60265291, 0.73163605], time:0.15637016ms
         out_f32x4: [0.60265291, 0.73163605], time:0.15648699ms
        out_f32_th: [0.60265291, 0.73163605], time:0.15514350ms
-------------------------------------------------------------------------------------
           out_f16: [0.60253906, 0.73144531], time:0.03343749ms
         out_f16x2: [0.60253906, 0.73144531], time:0.03304386ms
         out_f16x8: [0.60253906, 0.73144531], time:0.02936816ms
     out_f16x8pack: [0.60253906, 0.73144531], time:0.01532650ms
        out_f16_th: [0.60253906, 0.73144531], time:0.01900697ms
-------------------------------------------------------------------------------------
```